<div id="sect_title_img_2_6"></div>

<div id="sect_title_text"></div>

# ショートカットキーを割り当てる

<div id="preface"></div>

###### Blender本体の機能やアドオンの中には、ショートカットキーを割り当てることで頻繁に使う機能を素早く行えるようにできるものがあります。例えば、*3Dビュー* エリアのメニューである *オブジェクト* > *トランスフォーム* > *移動* で実行される機能には *G* キーが割り当てられてます。Blenderの機能と同様、個人で作成した機能にもショートカットキーを割り当てることができます。本節では [2-4節](04_Use_Property_on_Tool_Shelf_2.md) で紹介したサンプルを改良し、アドオンの機能にショートカットキーを割り当てる方法を紹介します。

## 作成するアドオンの仕様

* [2-4節](04_Use_Property_on_Tool_Shelf_2.md) で作成したサンプルを改良し、*3Dビュー* エリアのメニューである *オブジェクト* > *選択オブジェクトの複製* にショートカットキー（*ctrl* + *alt* + *R*）を割り当てる

## アドオンを作成する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考にして以下のソースコードを入力し、ファイル名を ```sample_2-6.py``` として保存してください。

[import](../../sample/src/chapter_02/sample_2-6.py)

<div id="space_m"></div>

## アドオンを使用する

### アドオンを有効化する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考に作成したアドオンを有効化すると、コンソールウィンドウに以下の文字列が出力されます。

```sh
サンプル2-6: アドオン「サンプル2-6」が有効化されました。
```

### アドオンの機能を使用する

*3Dビュー* エリア上でオブジェクトを選択し、*ctrl* + *alt* + *R* キーを押すと、*3Dビュー* エリアのメニューである *オブジェクト* > *選択オブジェクトの複製* を実行した時と同じく、選択されたオブジェクトが複製されます。

<div id="sidebyside"></div>

|右図は、オブジェクト *Cube* を選択して *ctrl* + *alt* + *R* キーを押した時の様子を示しています。|![オブジェクトの複複](https://dl.dropboxusercontent.com/s/sqzwdwfgs245mp6/use_add-on_1.png "オブジェクトの複製")|
|---|---|


### アドオンを無効化する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考にアドオンを無効化すると、コンソールウィンドウに以下の文字列が出力されます。

```sh
サンプル2-6: アドオン「サンプル2-6」が無効化されました。
```

## ソースコードの解説

### ショートカットキーの割り当て

ショートカットキーの割り当ては、 ```register_shortcut()``` 関数で行います。

[import:"register_shortcut"](../../sample_raw/src/chapter_02/sample_2-6.py)


```bpy.context.window_manager.keyconfigs.addon.keymaps``` はアドオンに割り当てられているキーマップです。

```keymaps.new()``` 関数を実行することで、新たにキーマップを割り当てることができます。本節のサンプルは ```keymaps.new()``` 関数に、以下に示す引数を指定してキーマップを割り当てます。

|引数|値の意味|
|---|---|
|```name```|キーマップ名|
|```space_type```|キーマップを割り当てるエリア名|

```km.keymap_items.new()``` 関数を使い、新しく割り当てたキーマップにショートカットキーを登録します。```km.keymap_items.new()``` 関数に指定する引数は以下の通りです。

|引数|値の意味|
|---|---|
|```idname```|イベント発生時に実行する処理を記述した、オペレータクラスの ```bl_idname``` |
|```type```|イベントを発生させるキーボードのキー|
|```value```|イベント発生の条件値|
|```shift```|イベント発生のためにshiftキーが押されている必要がある時は ```True```|
|```ctrl```|イベント発生のためにctrlキーが押されている必要がある時は ```True```|
|```alt```|イベント発生のためにaltキーが押されている必要がある時は ```True```|

本節のサンプルは、*shift* + *ctrl* + *R* キーが押された時にイベントを発生させ、オブジェクトの複製の処理をイベント発生時に実行するように引数を指定しています。イベント発生時に引数 ```idname``` に指定した処理を実行しますが、引数 ```value``` には例えば以下のようなイベントを発生する時の条件値を指定できます。

|イベント値|値の意味|
|---|---|
|```PRESS```|ボタンを押した時にイベントを発生させる|
|```RELEASE```|ボタンを離した時にイベントを発生させる|
|```ANY```|ボタンの状態に何かしら変更があった時にイベントを発生させる|
|```NOTHING```|イベントを発生させない|

最後に、割り当てたキーマップとショートカットキーのペアをグローバル変数 ```addon_keymaps``` に保存します。この変数はアドオン無効化時に、割り当ててたショートカットキーを削除するために必要になります。

### ショートカットキーの割り当て解除

アドオン内で登録したショートカットキーは、アドオン無効化時に割り当てを解除する必要があります。

ショートカットキーの割り当て解除は、 ```unregister_shortcut()``` 関数で行います。

[import:"unregister_shortcut"](../../sample_raw/src/chapter_02/sample_2-6.py)


アドオン有効化時にグローバル変数 ```addon_keymaps``` に保存したキーマップを、 ```keymap_items.remove()``` 関数の引数に指定して実行することで、ショートカットキーのペアを削除します。

そして最後に、キーマップとショートカットキーのペアを保存したグローバル変数 ```addon_keymaps``` をクリアします。


### 割り当てるショートカットキー

Blenderでは既に多くの機能にショートカットキーが割当てられているため、単一のキーの中からショートカットキーとして何も割当たっていないキーを探すのは意外と大変です。このため、**ctrlキーやshiftキー、altキーとの組み合わせたショートカットキーを割り当てる** ことも検討しましょう。これらのキーと組み合わせることで、既に割り当てられているキーと被る可能性を低くすることができ、より簡単に空いているキーを見つけることができると思います。本節のサンプルでも、ctrlキーやaltキーを組み合わせたショートカットキーを登録しています。

割り当てるショートカットキーは、**ショートカットキーを割り当てる機能を簡単に推測できる** ようなものにしましょう。ショートカットキーを割り当てる機能であるオブジェクトの複製は英訳するとReplicate Objectになるため、本節のサンプルでは英訳の頭文字を取って *R* キーを割り当てています。

## まとめ

[2-4節](04_Use_Property_on_Tool_Shelf_2.md) を改造し、*3Dビュー* エリアのメニューである *オブジェクト* > *選択オブジェクトの複製* にショートカットキーを割り当て、ショートカットキーからアドオンの機能を実行できるようにしました。ショートカットキーを機能に割り当てることで、ユーザが機能を素早く利用できるようになります。

頻繁に使う機能に対してショートカットキーを割り当てることは、アドオンの利便性の改善に繋がる可能性があります。一方、ショートカットキーに設定できる組み合わせには限りがあるため、ショートカットキーを乱用してユーザが利用可能なショートカットキーを減らしてしまうことは良いとは言えません。

アドオンを様々な人に使ってもらうことを考えている場合は、**ショートカットキーを設定することでユーザの利便性が本当に向上するのかを検討してから設定すべき** です。個人的に利用するアドオンではない限り、試しにショートカットキーを割り当てたとか、とりあえず割り当てとけば良い程度の判断でショートカットキーを設定すべきではありません。

<div id="point"></div>

### ポイント

<div id="point_item"></div>

* エリアごとのキーマップを割り当てた後にショートカットキーを割り当てることで、アドオンの機能にショートカットキーを割り当てることができる
* キーマップは、```bpy.context.window_manager.keyconfigs.addon.keymaps.new()``` 関数を実行することにより割り当てることができる
* ショートカットキーは、 キーマップ ```km``` に対して ```km.keymap_items.new()``` 関数を実行することにより割り当てることができる
* アドオン有効化時に割り当てたショートカットキーは、アドオン無効化時に割り当てを解除する必要がある
